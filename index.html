<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TKOH OT/IDSS åŸ¹è¨“ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'PingFang TC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .content {
            padding: 40px;
        }

        .login-form {
            max-width: 400px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .user-info {
            text-align: right;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .menu-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .menu-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .menu-item h3 {
            margin-top: 10px;
            font-size: 1.3em;
        }

        .role-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .role-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .role-card:hover {
            border-color: #667eea;
            transform: scale(1.05);
        }

        .role-card h4 {
            margin-top: 10px;
            color: #333;
        }

        .employee-list {
            margin-top: 20px;
        }

        .employee-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .hidden {
            display: none;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: #667eea;
            color: white;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .checklist-container {
            margin-top: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 20px;
        }

        .checklist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .checklist-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #ddd;
        }

        .checklist-item.critical {
            border-left-color: #dc3545;
            background: #fff5f5;
        }

        .checklist-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .checklist-item-title {
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .critical-badge {
            background: #dc3545;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8em;
        }

        .status-buttons {
            display: flex;
            gap: 10px;
        }

        .status-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .status-btn.pass {
            background: #28a745;
            color: white;
        }

        .status-btn.fail {
            background: #dc3545;
            color: white;
        }

        .status-btn.active {
            box-shadow: 0 0 0 3px rgba(0,0,0,0.2);
            transform: scale(1.05);
        }

        .remarks-section {
            margin-top: 10px;
        }

        .remarks-section textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .checklist-summary {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .deadline-toggle {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 20px;
            }

            .menu-grid {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¥ TKOH OT/IDSS åŸ¹è¨“ç³»çµ±</h1>
        </div>

        <div class="content">
            <!-- ç™»å…¥é é¢ -->
            <div id="loginPage">
                <div class="login-form">
                    <div class="form-group">
                        <label>ğŸ‘¤ å¸³è™Ÿ</label>
                        <input type="text" id="username" placeholder="è«‹è¼¸å…¥å¸³è™Ÿ">
                    </div>
                    <div class="form-group">
                        <label>ğŸ”’ å¯†ç¢¼</label>
                        <input type="password" id="password" placeholder="è«‹è¼¸å…¥å¯†ç¢¼">
                    </div>
                    <button class="btn btn-primary" onclick="login()" style="width: 100%">ğŸš€ ç™»å…¥ç³»çµ±</button>
                </div>
            </div>

            <!-- ä¸»é¸å–® -->
            <div id="mainMenu" class="hidden">
                <div class="user-info">
                    <span>ğŸ‘¤ æ­¡è¿ï¼Œ<strong id="currentUser"></strong></span>
                    <button class="btn btn-secondary" onclick="logout()" style="margin-left: 15px">ğŸšª ç™»å‡º</button>
                </div>

                <h2>ğŸ“‹ ä¸»é¸å–®</h2>
                <div class="menu-grid">
                    <div class="menu-item" onclick="showAccountManagement()">
                        <div style="font-size: 3em">ğŸ‘¥</div>
                        <h3>å¸³æˆ¶ç®¡ç†ç³»çµ±</h3>
                    </div>
                    <div class="menu-item" onclick="showTrainingData()">
                        <div style="font-size: 3em">ğŸ“š</div>
                        <h3>æ›´æ”¹åŸ¹è¨“è³‡æ–™</h3>
                    </div>
                    <div class="menu-item" onclick="showRoleSelection()">
                        <div style="font-size: 3em">ğŸ“Š</div>
                        <h3>é¸æ“‡å“¡å·¥è·ç´š</h3>
                    </div>
                </div>
            </div>

            <!-- å¸³æˆ¶ç®¡ç† -->
            <div id="accountManagement" class="hidden">
                <h2>ğŸ‘¥ å¸³æˆ¶ç®¡ç†ç³»çµ±</h2>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="showAddAccount()">â• æ–°å¢å¸³æˆ¶</button>
                    <button class="btn btn-secondary" onclick="showMainMenu()">ğŸ”™ è¿”å›</button>
                </div>
            </div>

            <!-- æ–°å¢å¸³æˆ¶ -->
            <div id="addAccount" class="hidden">
                <h2>â• æ–°å¢å¸³æˆ¶</h2>
                <div class="form-group">
                    <label>å¸³è™Ÿåç¨±</label>
                    <input type="text" id="newUsername" placeholder="è«‹è¼¸å…¥å¸³è™Ÿ">
                </div>
                <div class="form-group">
                    <label>å¯†ç¢¼</label>
                    <input type="password" id="newPassword" placeholder="è«‹è¼¸å…¥å¯†ç¢¼">
                </div>
                <div class="form-group">
                    <label>æ¬Šé™ç­‰ç´š</label>
                    <select id="userRole">
                        <option>ç®¡ç†å“¡</option>
                        <option>ä¸€èˆ¬ç”¨æˆ¶</option>
                    </select>
                </div>
                <div class="button-group">
                    <button class="btn btn-success" onclick="addAccount()">âœ“ ç¢ºèªæ–°å¢</button>
                    <button class="btn btn-secondary" onclick="showAccountManagement()">ğŸ”™ è¿”å›</button>
                </div>
            </div>

            <!-- åŸ¹è¨“è³‡æ–™ç®¡ç† -->
            <div id="trainingData" class="hidden">
                <h2>ğŸ“š æ›´æ”¹åŸ¹è¨“è³‡æ–™</h2>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="showAddCategory()">â• æ–°å¢åˆ†é¡</button>
                    <button class="btn btn-secondary" onclick="showMainMenu()">ğŸ”™ è¿”å›</button>
                </div>
            </div>

            <!-- æ–°å¢åˆ†é¡ -->
            <div id="addCategory" class="hidden">
                <h2>â• æ–°å¢åˆ†é¡</h2>
                <div class="form-group">
                    <label>åˆ†é¡åç¨±</label>
                    <input type="text" id="categoryName" placeholder="è«‹è¼¸å…¥åˆ†é¡åç¨±">
                </div>
                <div class="button-group">
                    <button class="btn btn-success" onclick="addCategory()">âœ“ ç¢ºèªæ–°å¢</button>
                    <button class="btn btn-secondary" onclick="showTrainingData()">ğŸ”™ è¿”å›</button>
                </div>
            </div>

            <!-- è·ç´šé¸æ“‡ -->
            <div id="roleSelection" class="hidden">
                <h2>ğŸ“Š é¸æ“‡å“¡å·¥è·ç´š</h2>
                <div class="role-grid">
                    <div class="role-card" onclick="showEmployeeList('PCA1')">
                        <div style="font-size: 3em">ğŸ‘¨â€ğŸ’¼</div>
                        <h4>PCA1</h4>
                    </div>
                    <div class="role-card" onclick="showEmployeeList('PCA2')">
                        <div style="font-size: 3em">ğŸ‘¨â€ğŸ’¼</div>
                        <h4>PCA2</h4>
                    </div>
                    <div class="role-card" onclick="showEmployeeList('PCA3')">
                        <div style="font-size: 3em">ğŸ‘¨â€ğŸ’¼</div>
                        <h4>PCA3</h4>
                    </div>
                    <div class="role-card" onclick="showEmployeeList('OTA')">
                        <div style="font-size: 3em">ğŸ©º</div>
                        <h4>OTA</h4>
                    </div>
                </div>
                <div class="button-group">
                    <button class="btn btn-secondary" onclick="showMainMenu()">ğŸ”™ è¿”å›</button>
                </div>
            </div>

            <!-- å“¡å·¥åˆ—è¡¨ -->
            <div id="employeeList" class="hidden">
                <h2>å“¡å·¥åˆ—è¡¨ - <span id="currentRole"></span></h2>
                <div class="employee-list" id="employeeListContent"></div>
                <div class="button-group">
                    <button class="btn btn-secondary" onclick="showRoleSelection()">ğŸ”™ è¿”å›</button>
                </div>
            </div>

            <!-- åŸ¹è¨“é€²åº¦ -->
            <div id="trainingProgress" class="hidden">
                <h2>åŸ¹è¨“é€²åº¦</h2>
                <div id="progressContent"></div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="exportPDF()">ğŸ“„ åŒ¯å‡º PDF</button>
                    <button class="btn btn-secondary" onclick="backToEmployeeList()">ğŸ”™ è¿”å›</button>
                </div>
            </div>

            <!-- åŸ¹è¨“é …ç›® -->
            <div id="trainingItems" class="hidden">
                <h2>åŸ¹è¨“é …ç›®</h2>
                
                <div class="form-group">
                    <label>æ¨™é¡Œ</label>
                    <input type="text" id="itemTitle" placeholder="è«‹è¼¸å…¥åŸ¹è¨“é …ç›®æ¨™é¡Œ">
                </div>

                <div class="deadline-toggle">
                    <div class="checkbox-group">
                        <input type="checkbox" id="noDeadline" onchange="toggleDeadline()">
                        <label for="noDeadline">ä¸éœ€è¦å®ŒæˆæœŸé™</label>
                    </div>
                    
                    <div class="form-group" id="deadlineGroup" style="margin-top: 15px;">
                        <label>å®ŒæˆæœŸé™</label>
                        <input type="date" id="itemDeadline">
                    </div>
                </div>

                <h3 style="margin-top: 30px;">åŸ¹è¨“ç´°é …æª¢æŸ¥æ¸…å–®</h3>
                <div class="checklist-container">
                    <div class="checklist-header">
                        <h4>æª¢æŸ¥é …ç›®</h4>
                        <button class="btn btn-primary" onclick="addChecklistItem()">â• æ–°å¢æª¢æŸ¥é …ç›®</button>
                    </div>

                    <div class="checklist-summary">
                        <div class="summary-item">
                            <span><strong>ç¸½é …ç›®æ•¸ï¼š</strong></span>
                            <span id="totalItems">0</span>
                        </div>
                        <div class="summary-item">
                            <span><strong>é‡è¦é …ç›®æ•¸ï¼š</strong></span>
                            <span id="criticalItems">0</span>
                        </div>
                        <div class="summary-item">
                            <span><strong>é€šéé …ç›®ï¼š</strong></span>
                            <span id="passedItems">0</span>
                        </div>
                        <div class="summary-item">
                            <span><strong>ä¸åˆæ ¼é …ç›®ï¼š</strong></span>
                            <span id="failedItems">0</span>
                        </div>
                        <div class="summary-item">
                            <span><strong>æ•´é«”ç‹€æ…‹ï¼š</strong></span>
                            <span id="overallStatus" style="font-weight: bold;">å¾…è©•ä¼°</span>
                        </div>
                    </div>

                    <div id="checklistItems"></div>
                </div>

                <div class="button-group">
                    <button class="btn btn-success" onclick="saveTrainingItem()">âœ“ å„²å­˜åŸ¹è¨“é …ç›®</button>
                    <button class="btn btn-warning" onclick="resetAllItems()">ğŸ”„ é‡è¨­æ‰€æœ‰é …ç›®</button>
                    <button class="btn btn-secondary" onclick="showMainMenu()">ğŸ”™ è¿”å›</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentPage = 'loginPage';
        let currentUserName = '';
        let selectedRole = '';
        let checklistItemsData = [];
        let checklistCounter = 0;

        function showPage(pageId) {
            document.querySelectorAll('.content > div').forEach(div => {
                div.classList.add('hidden');
            });
            document.getElementById(pageId).classList.remove('hidden');
            currentPage = pageId;
        }

        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username && password) {
                currentUserName = username === 'admin' ? 'ç³»çµ±ç®¡ç†å“¡' : username;
                document.getElementById('currentUser').textContent = currentUserName;
                showPage('mainMenu');
            } else {
                alert('è«‹è¼¸å…¥å¸³è™Ÿå’Œå¯†ç¢¼');
            }
        }

        function logout() {
            currentUserName = '';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            showPage('loginPage');
        }

        function showMainMenu() {
            showPage('mainMenu');
        }

        function showAccountManagement() {
            showPage('accountManagement');
        }

        function showAddAccount() {
            showPage('addAccount');
        }

        function addAccount() {
            const username = document.getElementById('newUsername').value;
            const password = document.getElementById('newPassword').value;
            const role = document.getElementById('userRole').value;
            
            if (username && password) {
                alert(`æˆåŠŸæ–°å¢å¸³æˆ¶ï¼š${username}\næ¬Šé™ï¼š${role}`);
                document.getElementById('newUsername').value = '';
                document.getElementById('newPassword').value = '';
                showPage('accountManagement');
            } else {
                alert('è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½');
            }
        }

        function showTrainingData() {
            showPage('trainingData');
        }

        function showAddCategory() {
            showPage('addCategory');
        }

        function addCategory() {
            const categoryName = document.getElementById('categoryName').value;
            
            if (categoryName) {
                alert(`æˆåŠŸæ–°å¢åˆ†é¡ï¼š${categoryName}`);
                document.getElementById('categoryName').value = '';
                showPage('trainingData');
            } else {
                alert('è«‹è¼¸å…¥åˆ†é¡åç¨±');
            }
        }

        function showRoleSelection() {
            showPage('roleSelection');
        }

        function showEmployeeList(role) {
            selectedRole = role;
            document.getElementById('currentRole').textContent = role;
            
            const mockEmployees = [
                { name: 'å¼µä¸‰', id: 'E001' },
                { name: 'æå››', id: 'E002' },
                { name: 'ç‹äº”', id: 'E003' }
            ];
            
            let html = '';
            mockEmployees.forEach(emp => {
                html += `
                    <div class="employee-item">
                        <span><strong>${emp.name}</strong> (${emp.id})</span>
                        <button class="btn btn-primary" onclick="showTrainingProgress('${emp.name}')">æŸ¥çœ‹é€²åº¦</button>
                    </div>
                `;
            });
            
            document.getElementById('employeeListContent').innerHTML = html;
            showPage('employeeList');
        }

        function showTrainingProgress(employeeName) {
            document.getElementById('progressContent').innerHTML = `
                <h3>å“¡å·¥ï¼š${employeeName}</h3>
                <table>
                    <thead>
                        <tr>
                            <th>åŸ¹è¨“é …ç›®</th>
                            <th>å®Œæˆç‹€æ…‹</th>
                            <th>å®Œæˆæ—¥æœŸ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>åŸºç¤åŸ¹è¨“</td>
                            <td>âœ“ å·²å®Œæˆ</td>
                            <td>2024-01-15</td>
                        </tr>
                        <tr>
                            <td>é€²éšåŸ¹è¨“</td>
                            <td>é€²è¡Œä¸­</td>
                            <td>-</td>
                        </tr>
                    </tbody>
                </table>
            `;
            showPage('trainingProgress');
        }

        function backToEmployeeList() {
            showEmployeeList(selectedRole);
        }

        function exportPDF() {
            alert('PDF åŒ¯å‡ºåŠŸèƒ½é–‹ç™¼ä¸­...');
        }

        function toggleDeadline() {
            const checkbox = document.getElementById('noDeadline');
            const deadlineGroup = document.getElementById('deadlineGroup');
            const deadlineInput = document.getElementById('itemDeadline');
            
            if (checkbox.checked) {
                deadlineGroup.style.display = 'none';
                deadlineInput.value = '';
                deadlineInput.removeAttribute('required');
            } else {
                deadlineGroup.style.display = 'block';
                deadlineInput.setAttribute('required', 'required');
            }
        }

        function addChecklistItem() {
            checklistCounter++;
            const item = {
                id: checklistCounter,
                title: '',
                isCritical: false,
                status: null,
                remarks: ''
            };
            checklistItemsData.push(item);
            renderChecklistItems();
        }

        function renderChecklistItems() {
            const container = document.getElementById('checklistItems');
            let html = '';
            
            checklistItemsData.forEach(item => {
                const criticalClass = item.isCritical ? 'critical' : '';
                const passActive = item.status === 'pass' ? 'active' : '';
                const failActive = item.status === 'fail' ? 'active' : '';
                
                html += `
                    <div class="checklist-item ${criticalClass}">
                        <div class="checklist-item-header">
                            <div class="checklist-item-title">
                                <input type="text" 
                                       placeholder="è«‹è¼¸å…¥æª¢æŸ¥é …ç›®åç¨±" 
                                       value="${item.title}"
                                       onchange="updateItemTitle(${item.id}, this.value)"
                                       style="border: 1px solid #ddd; padding: 5px 10px; border-radius: 4px; flex: 1;">
                                ${item.isCritical ? '<span class="critical-badge">âš ï¸ é‡è¦é …ç›®</span>' : ''}
                            </div>
                            <div class="status-buttons">
                                <button class="status-btn pass ${passActive}" onclick="setItemStatus(${item.id}, 'pass')">
                                    âœ“ åˆæ ¼
                                </button>
                                <button class="status-btn fail ${failActive}" onclick="setItemStatus(${item.id}, 'fail')">
                                    âœ— ä¸åˆæ ¼
                                </button>
                            </div>
                        </div>
                        <div style="margin-top: 10px; display: flex; gap: 10px; align-items: center;">
                            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                <input type="checkbox" 
                                       ${item.isCritical ? 'checked' : ''}
                                       onchange="toggleCritical(${item.id}, this.checked)">
                                <span>è¨­ç‚ºé‡è¦é …ç›®ï¼ˆå¿…é ˆé€šéï¼‰</span>
                            </label>
                            <button class="btn btn-danger" onclick="removeChecklistItem(${item.id})" style="padding: 5px 10px; font-size: 14px;">
                                ğŸ—‘ï¸ åˆªé™¤
                            </button>
                        </div>
                        <div class="remarks-section">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">å‚™è¨»ï¼š</label>
                            <textarea placeholder="è«‹è¼¸å…¥å‚™è¨»èªªæ˜..." 
                                      onchange="updateItemRemarks(${item.id}, this.value)">${item.remarks}</textarea>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            updateSummary();
        }

        function updateItemTitle(id, title) {
            const item = checklistItemsData.find(i => i.id === id);
            if (item) {
                item.title = title;
            }
        }

        function toggleCritical(id, isCritical) {
            const item = checklistItemsData.find(i => i.id === id);
            if (item) {
                item.isCritical = isCritical;
                renderChecklistItems();
            }
        }

        function setItemStatus(id, status) {
            const item = checklistItemsData.find(i => i.id === id);
            if (item) {
                item.status = item.status === status ? null : status;
                renderChecklistItems();
            }
        }

        function updateItemRemarks(id, remarks) {
            const item = checklistItemsData.find(i => i.id === id);
            if (item) {
                item.remarks = remarks;
            }
        }

        function removeChecklistItem(id) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤æª¢æŸ¥é …ç›®å—ï¼Ÿ')) {
                checklistItemsData = checklistItemsData.filter(i => i.id !== id);
                renderChecklistItems();
            }
        }

        function updateSummary() {
            const total = checklistItemsData.length;
            const critical = checklistItemsData.filter(i => i.isCritical).length;
            const passed = checklistItemsData.filter(i => i.status === 'pass').length;
            const failed = checklistItemsData.filter(i => i.status === 'fail').length;
            
            document.getElementById('totalItems').textContent = total;
            document.getElementById('criticalItems').textContent = critical;
            document.getElementById('passedItems').textContent = passed;
            document.getElementById('failedItems').textContent = failed;
            
            // è¨ˆç®—æ•´é«”ç‹€æ…‹
            let overallStatus = 'å¾…è©•ä¼°';
            let statusColor = '#6c757d';
            
            if (total > 0) {
                const allEvaluated = checklistItemsData.every(i => i.status !== null);
                const criticalItems = checklistItemsData.filter(i => i.isCritical);
                const allCriticalPassed = criticalItems.every(i => i.status === 'pass');
                
                if (allEvaluated) {
                    if (allCriticalPassed && failed === 0) {
                        overallStatus = 'âœ“ åˆæ ¼';
                        statusColor = '#28a745';
                    } else if (!allCriticalPassed) {
                        overallStatus = 'âœ— ä¸åˆæ ¼ï¼ˆé‡è¦é …ç›®æœªé€šéï¼‰';
                        statusColor = '#dc3545';
                    } else {
                        overallStatus = 'âœ— ä¸åˆæ ¼';
                        statusColor = '#dc3545';
                    }
                } else {
                    overallStatus = 'è©•ä¼°ä¸­';
                    statusColor = '#ffc107';
                }
            }
            
            const statusElement = document.getElementById('overallStatus');
            statusElement.textContent = overallStatus;
            statusElement.style.color = statusColor;
        }

        function resetAllItems() {
            if (confirm('ç¢ºå®šè¦é‡è¨­æ‰€æœ‰æª¢æŸ¥é …ç›®çš„ç‹€æ…‹å’Œå‚™è¨»å—ï¼Ÿ')) {
                checklistItemsData.forEach(item => {
                    item.status = null;
                    item.remarks = '';
                });
                renderChecklistItems();
            }
        }

        function saveTrainingItem() {
            const title = document.getElementById('itemTitle').value;
            const noDeadline = document.getElementById('noDeadline').checked;
            const deadline = document.getElementById('itemDeadline').value;
            
            if (!title) {
                alert('è«‹è¼¸å…¥åŸ¹è¨“é …ç›®æ¨™é¡Œ');
                return;
            }
            
            if (!noDeadline && !deadline) {
                alert('è«‹é¸æ“‡å®ŒæˆæœŸé™ï¼Œæˆ–å‹¾é¸ã€Œä¸éœ€è¦å®ŒæˆæœŸé™ã€');
                return;
            }
            
            if (checklistItemsData.length === 0) {
                alert('è«‹è‡³å°‘æ–°å¢ä¸€å€‹æª¢æŸ¥é …ç›®');
                return;
            }
            
            // æª¢æŸ¥æ˜¯å¦æ‰€æœ‰é …ç›®éƒ½æœ‰æ¨™é¡Œ
            const itemsWithoutTitle = checklistItemsData.filter(i => !i.title.trim());
            if (itemsWithoutTitle.length > 0) {
                alert('è«‹ç‚ºæ‰€æœ‰æª¢æŸ¥é …ç›®å¡«å¯«åç¨±');
                return;
            }
            
            const data = {
                title: title,
                deadline: noDeadline ? 'ç„¡æœŸé™' : deadline,
                checklistItems: checklistItemsData
            };
            
            console.log('å„²å­˜çš„åŸ¹è¨“é …ç›®è³‡æ–™ï¼š', data);
            alert('åŸ¹è¨“é …ç›®å·²æˆåŠŸå„²å­˜ï¼\n\næ¨™é¡Œï¼š' + title + '\nå®ŒæˆæœŸé™ï¼š' + (noDeadline ? 'ç„¡æœŸé™' : deadline) + '\næª¢æŸ¥é …ç›®æ•¸ï¼š' + checklistItemsData.length);
            
            // é‡è¨­è¡¨å–®
            document.getElementById('itemTitle').value = '';
            document.getElementById('noDeadline').checked = false;
            document.getElementById('itemDeadline').value = '';
            toggleDeadline();
            checklistItemsData = [];
            checklistCounter = 0;
            renderChecklistItems();
        }

        // åˆå§‹åŒ–
        showPage('loginPage');
    </script>
</body>
</html>
